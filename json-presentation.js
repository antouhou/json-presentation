(function($){$(function(){"use strict";var options={pathToPresentations:"./presentations.json"};var presentations=[];var presentationsList=[];var currentPresentation=0;var assert=function assert(condition,message){if(!condition){message=message||"Assert failed";throw new Error(message)}};var debounce=function debounce(func,time){var willBeCalled=0;return function deBounced(){var now=Date.now();var context=this;var args=arguments;if(willBeCalled<now){willBeCalled=now+time;setTimeout(function(){func.apply(context,args)},time)}}};var debouncedResize=debounce(function(){layout.reload();presentations[currentPresentation].reload();reloadAllPreviews()},500);var layout={init:function init(){this.container=$('<div class="presentation-container"></div>');this.controlsArea=$('<div class="controls"></div>');this.progressBar=$('<div class="progress-bar"></div>');this.slideJumpButtons=$('<div class="slide-jump"></div>');this.listButton=$('<div class="list-button">К списку презентаций</div>');this.controlButtons={prev:$('<div class="controls-button controls-prev"><</div>'),next:$('<div class="controls-button controls-next">></div>')};this.slideCount=$('<div class="slide-count"></div>');this.blackLayer=$('<div class="black-layer"></div>');this.presentationsList=$('<div class="presentations-list"></div>');this.presentationsListHeading=$("<h3>Список презентаций</h3>");this.presentationsListContainer=$('<div class="presentations-list-container"></div>');this.listBackward=$('<div class="presentations-list-backward-button controls-button">Отмена</div>');this.presentationsList.append(this.presentationsListHeading,this.presentationsListContainer,this.listBackward);this.container.append(this.controlsArea,this.blackLayer,this.presentationsList);this.controlsArea.append(this.progressBar,this.slideJumpButtons,this.listButton,this.controlButtons.prev,this.controlButtons.next,this.slideCount);$("body").append(this.container)},load:function load(){this.container.css({height:$(window).height()-this.controlsArea.height()});this.presentationsList.css({height:$(window).height()});this.presentationsListContainer.css({height:this.presentationsList.height()-this.listBackward.outerHeight(true)-this.presentationsListHeading.outerHeight(true)});this.listButton.on("click",list.show);this.listBackward.on("click",list.hide);this.blackLayer.css({height:$(window).height(),width:$(window).width()})},reload:function reload(){this.listBackward.off("click");this.listButton.off("click");this.load()}};var list={show:function show(){layout.presentationsList.animate({left:"0"},200);layout.controlsArea.animate({left:layout.presentationsList.width()},200);layout.container.animate({left:layout.presentationsList.width()},200);layout.blackLayer.fadeTo(200,.7)},hide:function hide(){layout.blackLayer.animate({left:0},200);layout.blackLayer.fadeOut(200);layout.presentationsList.animate({left:-layout.presentationsList.width()},200);layout.controlsArea.animate({left:0},200);layout.container.animate({left:0},200)}};var Slide=function Slide(slideData){this.caption=slideData.caption||"(Нет заголовка)";this.text=slideData.text||"(Пусто)";this.content='<div class="slide">'+"<h1>"+this.caption+"</h1>"+'<div class="slide-body">'+this.text+"</div>"+"</div>";this.body=$('<div class="slide-container">'+this.content+"</div>")};var Presentation=function Presentation(data,presentationId){try{this.name=data.name||"Без имени";assert(typeof presentationId==="number","Не передан ид презентации");assert(Array.isArray(data.slides),"В презентации отсутствуют слайды");assert(data.slides.length>0,"В презентации нет ни одного слайда");assert(typeof presentationId==="number","В констурктор презентации не передан id презентации")}catch(e){return alert('При обработке данных презентации "'+this.name+'" возникли ошибки. '+e)}this.id=presentationId;this.slides=[];this.currentSlide=0;this.body=$('<div class="presentation-body"></div>');this.body.css({display:"none"});this.load=function load(){currentPresentation=this.id;this.body.css({width:layout.container.width()*data.slides.length,display:"block"});layout.container.append(this.body);layout.slideCount.text("Слайд: "+(this.currentSlide+1)+"/"+this.slides.length);layout.progressBar.css({width:(this.currentSlide+1)/this.slides.length*100+"%"});$(".slide-container").css({width:layout.container.width()});$(".slide").css({height:layout.container.height()});this.showSlide(this.currentSlide);this.jumpButtons.show();layout.controlButtons.prev.on("click",function(){this.showPrevSlide()}.bind(this));layout.controlButtons.next.on("click",function(){this.showNextSlide()}.bind(this))};this.showNextSlide=function showNextSlide(){if(this.currentSlide<this.slides.length-1){this.currentSlide++;this.showSlide(this.currentSlide)}};this.showPrevSlide=function showPrevSlide(){if(this.currentSlide>0){this.currentSlide--;this.showSlide(this.currentSlide)}};this.showSlide=function showSlide(slideNumber){this.currentSlide=slideNumber;this.body.animate({"margin-left":-layout.container.width()*slideNumber});layout.slideCount.text("Слайд: "+(this.currentSlide+1)+"/"+this.slides.length);layout.progressBar.animate({width:(this.currentSlide+1)/this.slides.length*100+"%"});$(".slide-jump-button-active").removeClass("slide-jump-button-active");this.jumpButtons.buttons[slideNumber].body.addClass("slide-jump-button-active");if(slideNumber===0){layout.controlButtons.prev.addClass("controls-button-disabled")}else{if(layout.controlButtons.prev.hasClass("controls-button-disabled")){layout.controlButtons.prev.removeClass("controls-button-disabled")}}if(slideNumber===this.slides.length-1){layout.controlButtons.next.addClass("controls-button-disabled")}else{if(layout.controlButtons.next.hasClass("controls-button-disabled")){layout.controlButtons.next.removeClass("controls-button-disabled")}}};this.unload=function unload(positionReset){this.body.css({display:"none"});layout.controlButtons.prev.off("click");layout.controlButtons.next.off("click");this.jumpButtons.hide();if(positionReset){this.body.css({"margin-left":"0"});this.currentSlide=0}};this.reload=function reload(positionReset){this.unload(positionReset);this.load()};this.jumpButtons={buttons:[],body:$('<div style="display: none"></div>'),show:function show(){this.body.css({display:"block"})},hide:function hide(){this.body.css({display:"none"})}};for(var i=0;i<data.slides.length;i++){this.slides[i]=new Slide(data.slides[i]);this.body.append(this.slides[i].body);this.jumpButtons.buttons.push(new JumpButton(i));this.jumpButtons.body.append(this.jumpButtons.buttons[i].body)}layout.slideJumpButtons.append(this.jumpButtons.body)};var JumpButton=function JumpButton(slideId){this.body=$('<div class="slide-jump-button"></div>');this.showSlide=function ShowSlide(){presentations[currentPresentation].showSlide(slideId);$(".slide-jump-button-active").removeClass("slide-jump-button-active");this.body.addClass("slide-jump-button-active")}.bind(this);this.body.on("click",this.showSlide)};var ListItem=function ListItem(presentationName,presentationId){this.body=$("<li>"+presentationName+"</li>");this.preview=$('<div class="presentation-preview">'+presentations[presentationId].slides[0].content+"</div>");layout.container.append(this.preview);this.setPreview=function setPreview(){this.preview.css({height:layout.container.height(),top:($(window).height()-layout.container.height())/2,left:layout.presentationsList.width()+($(window).width()-this.preview.width())})};this.setPreview();this.showPreview=function showPreview(){this.preview.css({display:"block"}).animate({left:(layout.container.width()+200-this.preview.width())/2,opacity:1},400)};this.hidePreview=function hidePreview(){this.preview.animate({left:0,opacity:0},400,function(){this.preview.css({display:"none",left:layout.presentationsList.width()+($(window).width()-this.preview.width())})}.bind(this))};this.action=function action(){presentationsList[currentPresentation].body.removeClass("active-class");presentations[currentPresentation].unload(true);presentations[presentationId].load();this.body.addClass("active-class");list.hide();this.hidePreview()};this.body.hover(this.showPreview.bind(this),this.hidePreview.bind(this));this.body.on("click",this.action.bind(this))};var reloadAllPreviews=function reloadAllPreviews(){for(var i=0;i<presentationsList.length;i++){presentationsList[i].setPreview()}};layout.init();layout.load();$.getJSON(options.pathToPresentations).done(function(data){try{assert(data!=null,"Файл пуст");assert(Array.isArray(data),"Данные в файле не являются массивом");assert(data.length>0,"Массив презентаций пуст")}catch(e){return alert("При загрузке презентаций возникли ошибки! "+e)}for(var i=0;i<data.length;i++){presentations.push(new Presentation(data[i],i));presentationsList[i]=new ListItem(presentations[i].name,i);layout.presentationsListContainer.append(presentationsList[i].body)}presentations[currentPresentation].load()}).error(function(){alert("Не удалось загрузить файл с презентациями!")});$(window).resize(debouncedResize)})})($);